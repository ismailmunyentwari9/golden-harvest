var __experiments__3d82474ef8712fa5012b=function(n){var i={};function o(e){var t;return(i[e]||(t=i[e]={i:e,l:!1,exports:{}},n[e].call(t.exports,t,t.exports,o),t.l=!0,t)).exports}return o.m=n,o.c=i,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=16)}([function(e,d,t){"use strict";!function(t){function s(e){return null!=e&&"function"==typeof e.then}function c(e){return null!=e&&"function"==typeof e.cancel}function e(e,t){if(d.config.catchExceptions)try{e()}catch(e){return t(e)}else e()}
/**
 * SyncTasks.ts
 * Author: David de Regt
 * Copyright: Microsoft 2015
 *
 * A very simple promise library that resolves all promises synchronously instead of
 * kicking them back to the main ticking thread.  This affirmatively rejects the A+
 * standard for promises, and is used for a combination of performance (wrapping
 * things back to the main thread is really slow) and because indexeddb loses
 * context for its calls if you send them around the event loop and transactions
 * automatically close.
 */
Object.defineProperty(d,"__esModule",{value:!0}),d.config={exceptionsToConsole:!0,catchExceptions:!0,traceEnabled:!1,exceptionHandler:void 0,unhandledErrorHandler:function(e){throw e}},d.fromThenable=function(e){var t=h();return e.then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise().thenAsync(function(e){return e})};var a,n,i=[],o=void 0!==t;function r(e){i.push(e),1===i.length&&(o?t(u):setTimeout(u,0))}function u(){var e=i;i=[];for(var t=0;t<e.length;t++)e[t]()}function l(){this._completedSuccess=!1,this._completedFail=!1,this._traceEnabled=!1,this._cancelCallbacks=[],this._wasCanceled=!1,this._wasExplicitlyCanceled=!1,this._resolving=!1,this._storedCallbackSets=[],this._mustHandleError=!0}function h(){return new a.SyncTask}function f(e){return(new a.SyncTask).resolve(e).promise()}function p(e){var t=h(),n=!1;return t.onCancel(function(t){e.forEach(function(e){c(e)&&a.SyncTask.cancelOtherInternal(e,t)})}),e.forEach(function(e){s(e)?e.then(function(e){n||(n=!0,t.resolve(e))},function(e){n||(n=!0,t.reject(e))}):n||(n=!0,t.resolve(e))}),t.promise()}d.asyncCallback=r,n=a=a||{},l.prototype._addCallbackSet=function(t,e){var n=this,i=new l;return i.onCancel(function(e){t.wasCanceled=!0,t.cancelContext=e,n._cancelInternal(e)}),t.task=i,this._storedCallbackSets.push(t),e?this._mustHandleError=!1:i._mustHandleError=!1,this._resolving||(this._completedSuccess?this._resolveSuccesses():this._completedFail&&this._resolveFailures()),i.promise()},l.prototype.onCancel=function(e){return this._completedSuccess||this._completedFail||(this._wasCanceled?e(this._cancelContext):this._cancelCallbacks.push(e)),this},l.prototype.then=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t},!0)},l.prototype.thenAsync=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t,asyncCallback:!0},!0)},l.prototype.catch=function(e){return this._addCallbackSet({failFunc:e},!0)},l.prototype.always=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!0)},l.prototype.setTracingEnabled=function(e){return this._traceEnabled=e,this},l.prototype.finally=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!1),this},l.prototype.done=function(e){return this._addCallbackSet({successFunc:e},!1),this},l.prototype.fail=function(e){return this._addCallbackSet({failFunc:e},!1),this},l.prototype.resolve=function(e){return this._checkState(!0),this._completedSuccess=!0,this._storedResolution=e,this._cancelCallbacks=[],this._resolveSuccesses(),this},l.prototype.reject=function(e){return this._checkState(!1),this._completedFail=!0,this._storedErrResolution=e,this._cancelCallbacks=[],this._resolveFailures(),l._enforceErrorHandled(this),this},l.prototype._checkState=function(e){if(this._completedSuccess||this._completedFail)throw this._completeStack&&console.error(this._completeStack.message,this._completeStack.stack),e="Failed to "+(e?"resolve":"reject")+": the task is already "+(this._completedSuccess?"resolved":"rejected"),new Error(e);(d.config.traceEnabled||this._traceEnabled)&&(this._completeStack=new Error("resolve"))},l._enforceErrorHandled=function(e){e._mustHandleError&&(l._rejectedTasks.push(e),l._enforceErrorHandledTimer||(l._enforceErrorHandledTimer=setTimeout(function(){l._enforceErrorHandledTimer=void 0;var e=l._rejectedTasks;l._rejectedTasks=[],e.forEach(function(e,t){e._mustHandleError&&d.config.unhandledErrorHandler(e._storedErrResolution)})},0)))},l.prototype.cancel=function(e){if(this._wasExplicitlyCanceled)throw new Error("Already Canceled");this._wasExplicitlyCanceled=!0,this._cancelInternal(e)},l.prototype._cancelInternal=function(e){var t=this;this._wasCanceled||(this._wasCanceled=!0,this._cancelContext=e,e=this._cancelCallbacks,this._cancelCallbacks=[],0<e.length&&e.forEach(function(e){t._completedSuccess||t._completedFail||e(t._cancelContext)}))},l.cancelOtherInternal=function(e,t){var n=e;n._storedCallbackSets&&n._cancelInternal?n._cancelInternal(t):e.cancel(t)},l.prototype.promise=function(){return this},l.prototype._resolveSuccesses=function(){var t=this;for(this._resolving=!0;this._storedCallbackSets.length;){var e=this._storedCallbackSets;this._storedCallbackSets=[],e.forEach(function(e){e.asyncCallback?r(function(){return t._resolveSuccessCallback(e)}):t._resolveSuccessCallback(e)})}this._resolving=!1},l.prototype._resolveSuccessCallback=function(n){var i=this;n.successFunc?e(function(){var t=n.successFunc(i._storedResolution);c(t)&&(n.wasCanceled?l.cancelOtherInternal(t,n.cancelContext):n.task.onCancel(function(e){return l.cancelOtherInternal(t,e)})),s(t)?t.then(function(e){n.task.resolve(e)},function(e){n.task.reject(e)}):n.task.resolve(t)},function(e){i._handleException(e,"SyncTask caught exception in success block: "+e.toString()),n.task.reject(e)}):n.task.resolve(this._storedResolution)},l.prototype._resolveFailures=function(){var t=this;for(this._resolving=!0;this._storedCallbackSets.length;){var e=this._storedCallbackSets;this._storedCallbackSets=[],e.forEach(function(e){e.asyncCallback?r(function(){return t._resolveFailureCallback(e)}):t._resolveFailureCallback(e)})}this._resolving=!1},l.prototype._resolveFailureCallback=function(n){var i=this;n.failFunc?e(function(){var t=n.failFunc(i._storedErrResolution);c(t)&&(n.wasCanceled?l.cancelOtherInternal(t,n.cancelContext):n.task.onCancel(function(e){return l.cancelOtherInternal(t,e)})),s(t)?t.then(function(e){n.task.resolve(e)},function(e){n.task.reject(e)}):n.task.resolve(t)},function(e){i._handleException(e,"SyncTask caught exception in failure block: "+e.toString()),n.task.reject(e)}):n.task.reject(this._storedErrResolution)},l.prototype._handleException=function(e,t){d.config.exceptionsToConsole&&console.error(t),d.config.exceptionHandler&&d.config.exceptionHandler(e)},l.prototype.toEs6Promise=function(){var n=this;return new Promise(function(e,t){return n.then(e,t)})},l._rejectedTasks=[],n.SyncTask=l,d.all=function(e){var t,n,i,o,r;return 0===e.length?f([]):(t=h(),n=e.length,o=Array(e.length),t.onCancel(function(t){e.forEach(function(e){c(e)&&a.SyncTask.cancelOtherInternal(e,t)})}),r=function(){0==--n&&(void 0!==i?t.reject(i):t.resolve(o))},e.forEach(function(e,t){s(e)?e.then(function(e){o[t]=e,r()},function(e){void 0===i&&(i=void 0===e||e),r()}):(o[t]=e,r())}),t.promise())},d.Defer=h,d.Resolved=f,d.Rejected=function(e){return(new a.SyncTask).reject(e).promise()},d.race=p,d.raceTimer=function(e,t){var n=h(),i=setTimeout(function(){n.resolve({timedOut:!0})},t);return p([e.then(function(e){return clearTimeout(i),{timedOut:!1,result:e}}),n.promise()])}}.call(this,t(19).setImmediate)},function(e,t,n){"use strict";n.r(t),n.d(t,"PhysicalEnvironment",function(){return i}),n.d(t,"isTrackableBuild",function(){return c}),n.d(t,"toUpperCase",function(){return a}),n.d(t,"isDevelopment",function(){return u}),n.d(t,"isTesting",function(){return l}),n.d(t,"isOutlook",function(){return h}),n.d(t,"getEnv",function(){return f}),n.d(t,"getPhysicalEnv",function(){return p}),n.d(t,"getPhysicalRing",function(){return d}),n.d(t,"isSovereignEnv",function(){return _}),n.d(t,"isGccModerate",function(){return g}),n.d(t,"isGccHigh",function(){return y}),n.d(t,"isDoD",function(){return m}),n.d(t,"isDebugMode",function(){return v}),n.d(t,"isBeta",function(){return T});var i,o=n(2),r=n(12),s=(n.d(t,"getServiceEndpoint",function(){return r.getServiceEndpoint}),(n=i=i||{}).GCCMODERATE="GCCMODERATE",n.PROD="PROD",n.SDF="SDF",n.UNKNOWN="UNKNOWN",n.GCCHIGH="GCCHIGH",n.DOD="DOD",{SDFV2:"dogfood",MSIT:"dogfood",WW:"production",SIP:"production",DONMT:"production",BLACKFOREST:"production",UNKNOWNPHYSICALRING:"production",UNKNOWN:"production",GALLATIN:"production",TDF:"production"}),c=-1<["production","beta","weekly","nightly"].indexOf("production"),a=function(e){return e&&e.toUpperCase()},u=!1,l=!1,h=!0,f=function(){var e=d();return s[a(e)]||"production"},p=function(){return Object(o.getMetaTagValue)("physicalEnvironment")},d=function(){return Object(o.getMetaTagValue)("physicalRing")},_=function(){var e=a(p());return e===i.GCCMODERATE||e===i.GCCHIGH||e===i.DOD},g=function(){return a(p())===i.GCCMODERATE},y=function(){return a(p())===i.GCCHIGH},m=function(){return a(p())===i.DOD},v=function(){return localStorage&&"true"===localStorage.getItem("to_do_web_debug")},T=function(){var e,t=null==(e=null===window||void 0===window?void 0:window.location)?void 0:e.hostname;return t&&[/^(www.)?beta.to-do.microsoft.com$/,/^(www.)?beta.to-do.officeppe.com$/].some(function(e){return e.test(t)})}},function(e,t,n){"use strict";n.r(t),n.d(t,"getMetaTagValue",function(){return o});var i=n(14),o=function(e){return Object(i.findMetaTag)(e)||""}},function(e,t,n){"use strict";
/**
* Models.ts
* Author: CALIB http://aka.ms/CALIB
* Copyright: Microsoft 2017
*
* ECS models
*/Object.defineProperty(t,"__esModule",{value:!0}),(t=t.EcsConfigType||(t.EcsConfigType={}))[t.Default=0]="Default",t[t.User=1]="User"},function(e,t,n){"use strict";
/**
*
* Author: CALIB http://aka.ms/CALIB
* Copyright: Microsoft 2017
*
* ECS Module
*/Object.defineProperty(t,"__esModule",{value:!0});var i=n(18),o=n(22),r=n(23),s=n(24),c=n(3),a=(t.Models=c,n(25)),u=n(32),l=n(33);function h(){this._allowBackgroundFetchData=new i.default,this._appActiveData=new o.default,this._config=new s.default,this._cache=new r.default(this._config),this._skypeTokenData=new u.default,this._telemetryManager=new l.default(this._cache),this._scheduler=new a.default(this._config,this._skypeTokenData,this._cache,this._appActiveData,this._allowBackgroundFetchData,this._telemetryManager),this.telemetryEventAdded=this._telemetryManager.telemetryEventAdded,this.configUpdated=this._cache.configUpdated}h.prototype.initialize=function(e){var t=this;return this._config.initialize(e),this._skypeTokenData.putSkypeTokenData(e.initialSkypeTokenData),this._appActiveData.putAppActive(e.initialAppActiveState),this._cache.initialize().then(function(){t._scheduler.initialize()})},h.prototype.getConfig=function(){return this._cache.getEcsConfig()},h.prototype.getConfigType=function(){var e=this._cache.getEcsConfig();if(e)return e.configType},h.prototype.requestUpdate=function(){this._scheduler.requestUpdate()},h.prototype.pause=function(){this._scheduler.pause()},h.prototype.resume=function(){this._scheduler.resume()},h.prototype.setAllowBackgroundFetch=function(e){this._allowBackgroundFetchData.putBackgroundFetchAllowed(e)},h.prototype.useSkypeToken=function(e,t){this._skypeTokenData.putSkypeTokenData({skypeToken:e,skypeTokenExpiration:t})},h.prototype.setAppActive=function(e){this._appActiveData.putAppActive(e)},h.prototype.setConfigsToFetch=function(e){var t=this;return this._config.setConfigsToFetch(e),this._cache.updateConfigsToFetch().then(function(){t._scheduler.updateConfigsToFetch()})},h.prototype.setFetchTimeout=function(e){this._config.setFetchTimeout(e)},t.default=h},function(e,t,n){"use strict";n.r(t),n.d(t,"SubscriptionToken",function(){return i});
/**
 * SubscribableEvent.ts
 *
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT license.
 *
 * A simple strongly-typed pub/sub/fire eventing system.
 */
o.prototype.unsubscribe=function(){this._event.unsubscribe(this._callback)};var i=o;function o(e,t){this._event=e,this._callback=t}function r(e){var r=this;this._allowStopPropagation=e=void 0===e?!1:e,this.fire=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=r._subscribers,i=n.length-1;0<=i;i--){var o=n[i].apply(null,e);if(r._allowStopPropagation&&o)return!0}return!1},this._subscribers=[]}r.prototype.dispose=function(){this._subscribers=[]},r.prototype.subscribe=function(e){return this._subscribers=this._subscribers.concat(e),new i(this,e)},r.prototype.unsubscribe=function(t){this._subscribers=this._subscribers.filter(function(e){return e!==t})},t.default=r},function(e,i,t){"use strict";
/**
 * utils.ts
 * Copyright: Microsoft 2019
 */var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(i,"__esModule",{value:!0}),i.assert=function(e,t){if(!e)throw new Error(t)},i.isObject=function(e){return null!==e&&"object"==typeof e},i.isString=function(e){return"string"==typeof e},i.attempt=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];try{return e.apply(void 0,t)}catch(e){return new Error(e)}},i.remove=function(e,t){for(var n=e.length-1;0<=n;n--)e[n]===t&&e.splice(n,1)},i.clone=function(n){return Array.isArray(n)?n.map(i.clone):i.isObject(n)?Object.keys(n).reduce(function(e,t){return o(o({},e),((e={})[t]=i.clone(n[t]),e))},{}):n}},function(e,t,n){"use strict";n.r(t),n.d(t,"read",function(){return s}),n.d(t,"write",function(){return c});function i(e){try{return e.setItem(o,o),e.removeItem(o),1}catch(e){return}}var t=n(13),o="experiments_test_key",r=i(localStorage)?localStorage:i(sessionStorage)?sessionStorage:new t.default,s=function(e){try{return JSON.parse(r.getItem(e))||null}catch(e){return null}},c=function(e,t){return r.setItem(e,JSON.stringify(t))}},function(e,t,n){"use strict";n.r(t),n.d(t,"initialize",function(){return s});function f(){return r(w.getConfig())}var p,d=n(4),t=n.n(d),_=n(0),g=n(7),n=n(1),i="ToDoClient",y="Web",m="https://config.edge.skype.net",v=Object(n.getServiceEndpoint)("ecsUrl"),T={0:"ecs_default_config",1:"ecs_user_config"},o={configIDs:"",experiments:{}},b=function(e){return"development"===e||"staging"===e},k=function(e){return e.split(".").slice(0,2).join(".")},C=function(e){return e&&e.split("_").shift()},w=new t.a,r=function(e){return e&&e.config?{configIDs:e.config.ConfigIDs&&e.config.ConfigIDs[i]||"",experiments:e.config[i]||{}}:o},S=function(e){switch(e){case"dogfood":case"beta":return"Microsoft";case"production":return"Public";default:return"Dev"}},s=function(e,t){var n,i,o,r,s,c,a,u,l,h;return void 0===t&&(t=function(e){return e}),"test"===e.env||b(e.env)?Promise.resolve():(i=e.name,o=e.version,r=e.env,s=e.user,c=e.lang,a=e.hubName,u=e.hubClientType,l=k(o),h=C(c),n={hosts:[b(r)?m:v],clientName:i,clientVersion:l,configsToFetch:[d.Models.EcsConfigType.Default,d.Models.EcsConfigType.User],getEcsParameters:function(){return Object(_.Resolved)({ClientId:s.id,Platform:y,HubName:""===a?"Web":a,HubClientType:""===u?"web":u,AppVersion:l,AccountType:"msa"===s.authType?"MSA":s.tid,Audience:S(r),Language:h})},initialAppActiveState:!0,databaseInterface:{putData:function(e,t){return Object(_.Resolved)(Object(g.write)(T[e],t))},getData:function(e){return Object(_.Resolved)(Object(g.read)(T[e]))}}},w.configUpdated.subscribe(function(){return t(f())}),p?Promise.resolve(f()):(p=!0,new Promise(function(e){w.initialize(n).then(function(){return e(f())}),setTimeout(function(){return e(f())},1e3)})))}},function(e,t){var n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,o,t){"use strict";
/**
 * ExponentialTime.ts
 * Author: David de Regt
 * Copyright: Microsoft 2016
 *
 * Timer to be used for exponential backoff.  Integrates jitter so as to not slam all services at the same time after backoffs.
 */Object.defineProperty(o,"__esModule",{value:!0});var r=t(6),t=(o.DEFAULT_TIME_GROW_FACTOR=2.718281828459045,o.DEFAULT_TIME_JITTER=.11962656472,n.prototype.reset=function(){this._incrementCount=0,this._currentTime=Math.round(this._initialTime*(1+Math.random()*this._jitterFactor))},n.prototype.getTime=function(){return this._currentTime},n.prototype.getIncrementCount=function(){return this._incrementCount},n.prototype.calculateNext=function(){var e=this._currentTime*this._growFactor;return e>this._maxTime&&(e=this._maxTime),this._jitterFactor<1e-5?this._currentTime=e:this._currentTime=Math.round(Math.random()*e*this._jitterFactor+e),this._currentTime<this._initialTime&&(this._currentTime=this._initialTime),this._currentTime>this._maxTime&&(this._currentTime=this._maxTime),this._incrementCount++,this._currentTime},n.prototype.getTimeAndCalculateNext=function(){var e=this.getTime();return this.calculateNext(),e},n);function n(e,t,n,i){void 0===n&&(n=o.DEFAULT_TIME_GROW_FACTOR),void 0===i&&(i=o.DEFAULT_TIME_JITTER),this._initialTime=e,this._maxTime=t,this._growFactor=n,this._jitterFactor=i,r.assert(0<this._initialTime,"Initial delay must be positive"),r.assert(0<this._maxTime,"Delay upper bound must be positive"),r.assert(0<=this._growFactor,"Ratio must be non-negative"),r.assert(0<=this._jitterFactor,"Jitter factor must be non-negative"),this.reset()}o.ExponentialTime=t},function(e,a,t){"use strict";
/**
 * SimpleWebRequest.ts
 * Author: David de Regt
 * Copyright: Microsoft 2016
 *
 * Simple client for issuing web requests.
 */var i,n,c,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},s=(Object.defineProperty(a,"__esModule",{value:!0}),t(0)),u=t(6),l=t(10);function h(e){return e&&0===e.indexOf("application/json")}function f(e,t){return t.canceled||!t.statusCode||400<=t.statusCode&&t.statusCode<600?c.DoNotRetry:c.RetryCountedWithBackoff}(t=n=a.WebRequestPriority||(a.WebRequestPriority={}))[t.DontCare=0]="DontCare",t[t.Low=1]="Low",t[t.Normal=2]="Normal",t[t.High=3]="High",t[t.Critical=4]="Critical",(t=c=a.ErrorHandlingType||(a.ErrorHandlingType={}))[t.DoNotRetry=0]="DoNotRetry",t[t.RetryUncountedImmediately=1]="RetryUncountedImmediately",t[t.RetryUncountedWithBackoff=2]="RetryUncountedWithBackoff",t[t.RetryCountedWithBackoff=3]="RetryCountedWithBackoff",t[t.PauseUntilResumed=4]="PauseUntilResumed",a.DefaultOptions={priority:n.Normal},a.SimpleWebRequestOptions={MaxSimultaneousRequests:5,HungRequestCleanupIntervalMs:1e4,setTimeout:function(e,t){return setTimeout(e,t)},clearTimeout:function(e){return clearTimeout(e)}},a.DefaultErrorHandler=f;var p,d=[],_=[],g=[],y=0,m=0,v=(T.prototype.getPriority=function(){return this._options.priority||n.DontCare},T.checkQueueProcessing=function(){for(;0<d.length&&g.length<a.SimpleWebRequestOptions.MaxSimultaneousRequests;)!function(){var t=d.shift();_.push(t),(t._blockRequestUntil&&t._blockRequestUntil()||s.Resolved()).finally(function(){u.remove(_,t)}).then(function(){g.length<a.SimpleWebRequestOptions.MaxSimultaneousRequests&&!t._aborted?(g.push(t),k._scheduleHungRequestCleanupIfNeeded(),t._fire()):t._enqueue()},function(e){t._respond("_blockRequestUntil rejected: "+e)})}()},T._scheduleHungRequestCleanupIfNeeded=function(){0<g.length&&void 0===p?p=a.SimpleWebRequestOptions.setTimeout(this._hungRequestCleanupTimerCallback,a.SimpleWebRequestOptions.HungRequestCleanupIntervalMs):0===g.length&&p&&(a.SimpleWebRequestOptions.clearTimeout(p),p=void 0)},T.prototype._removeFromQueue=function(){u.remove(g,this),u.remove(d,this)},T.prototype._assertAndClean=function(e,t){e||(this._removeFromQueue(),console.error(t),u.assert(e,t))},T.prototype._fire=function(){var i=this,e=(this._xhr=new XMLHttpRequest,this._xhrRequestHeaders={},u.attempt(function(){i._xhr.open(i._action,i._url,!0)}));if(e)this._respond(e.toString());else{this._options.timeout&&(3!==(t=m)&&(this._assertAndClean(!this._requestTimeoutTimer,"Double-fired requestTimeoutTimer"),this._requestTimeoutTimer=a.SimpleWebRequestOptions.setTimeout(function(){i._requestTimeoutTimer=void 0,i._timedOut=!0,i.abort()},this._options.timeout)),(3===t||t<=1)&&(this._xhr.timeout=this._options.timeout,this._xhr.ontimeout=function(){(m=3)===t&&(i._timedOut=!0,i._aborted=!0,i._respond("TimedOut"))}));var t,n=y,e=(3!==n?(0===n&&(y=1),this._xhr.onreadystatechange=function(){i._xhr&&(3===i._xhr.readyState&&i._options.streamingDownloadProgress&&!i._aborted?i._options.streamingDownloadProgress(i._xhr.responseText):4===i._xhr.readyState&&(0===n&&1===y&&a.SimpleWebRequestOptions.setTimeout(function(){3!==y&&(y=2)},1e4),i._respond()))}):this._options.streamingDownloadProgress&&(this._xhr.onreadystatechange=function(){i._xhr&&3===i._xhr.readyState&&i._options.streamingDownloadProgress&&!i._aborted&&i._options.streamingDownloadProgress(i._xhr.responseText)}),2!==n&&(this._xhr.onload=function(){(y=3)===n&&i._respond()},this._xhr.onerror=function(){(y=3)===n&&i._respond()}),this._xhr.onabort=function(){i._aborted=!0,i._respond("Aborted")},this._xhr.upload&&this._options.onProgress&&(this._xhr.upload.onprogress=this._options.onProgress),this._options.acceptType||"json"),o=this._options.customResponseType||T._getResponseType(e),r=u.attempt(function(){i._xhr.responseType=o});if(r&&"json"!==o)throw r;k._setRequestHeader(this._xhr,this._xhrRequestHeaders,"Accept",T.mapContentType(e)),this._xhr.withCredentials=!!this._options.withCredentials;var s=this.getRequestHeaders(),c={};Object.keys(s).forEach(function(e){var t=s[e],n=e.toLowerCase();"content-type"===n?i._assertAndClean(!1,"Don't set Content-Type with options.headers -- use it with the options.contentType property"):"accept"===n?i._assertAndClean(!1,"Don't set Accept with options.headers -- use it with the options.acceptType property"):(i._assertAndClean(!c[n],"Setting duplicate header key: "+c[n]+" and "+e),null==t?console.warn('Tried to set header "'+e+'" on request with "'+t+'" value, header will be dropped'):(c[n]=!0,k._setRequestHeader(i._xhr,i._xhrRequestHeaders,e,t)))}),this._options.sendData?(r=T.mapContentType(this._options.contentType||"json"),k._setRequestHeader(this._xhr,this._xhrRequestHeaders,"Content-Type",r),e=T.mapBody(this._options.sendData,r),this._xhr.send(e)):this._xhr.send()}},T._setRequestHeader=function(e,t,n,i){e.setRequestHeader(n,i),t[n]=i},T.mapContentType=function(e){return"json"===e?"application/json":"form"===e?"application/x-www-form-urlencoded":e},T.mapBody=function(e,t){if(h(t)){if(!u.isString(e))return JSON.stringify(e)}else if((r=t)&&0===r.indexOf("application/x-www-form-urlencoded")){var n;if(!u.isString(e)&&u.isObject(e))return n=e,Object.keys(n).map(function(e){return encodeURIComponent(e)+(n[e]?"="+encodeURIComponent(n[e].toString()):"")}).join("&")}else if((r=t)&&0===r.indexOf("multipart/form-data")){var i,o;if(u.isObject(e))return i=new FormData,o=e,Object.keys(o).forEach(function(e){return i.append(e,o[e])}),i;u.assert(!1,"contentType multipart/form-data must include an object as sendData")}var r;return e},T.prototype.setUrl=function(e){this._url=e},T.prototype.setHeader=function(e,t){this._options.augmentHeaders||(this._options.augmentHeaders={}),t?this._options.augmentHeaders[e]=t:delete this._options.augmentHeaders[e]},T.prototype.getRequestHeaders=function(){var e={};return!this._getHeaders||this._options.overrideGetHeaders||this._options.headers||(e=r(r({},e),this._getHeaders())),this._options.overrideGetHeaders&&(e=r(r({},e),this._options.overrideGetHeaders)),this._options.headers&&(e=r(r({},e),this._options.headers)),e=this._options.augmentHeaders?r(r({},e),this._options.augmentHeaders):e},T.prototype.getOptions=function(){return u.clone(this._options)},T.prototype.setPriority=function(e){this._options.priority!==e&&(this._options.priority=e,this._paused||this._xhr||(u.remove(d,this),this._enqueue()))},T.prototype.resumeRetrying=function(){this._paused?(this._paused=!1,this._enqueue()):u.assert(!1,"resumeRetrying() called but not paused!")},T.prototype._enqueue=function(){var e,t=this;this._aborted||0<=g.indexOf(this)||0<=_.indexOf(this)||0<=d.indexOf(this)||(-1<(e=d.findIndex(function(e){return e.getPriority()===t.getPriority()&&e._created>t._created||e.getPriority()<t.getPriority()}))?d.splice(e,0,this):d.push(this),T.checkQueueProcessing())},T._getResponseType=function(e){return"blob"===e?"arraybuffer":"text/xml"===e||"application/xml"===e?"document":"text/plain"===e?"text":"json"},T._hungRequestCleanupTimerCallback=function(){p=void 0,g.filter(function(e){return!(!e._xhr||4!==e._xhr.readyState)&&(console.warn("SimpleWebRequests found a completed XHR that hasn't invoked it's callback functions, manually responding"),!0)}).forEach(function(e){e._respond()}),k._scheduleHungRequestCleanupIfNeeded()},T);function T(e,t,n,i,o){this._action=e,this._url=t,this.options=n,this._getHeaders=i,this._blockRequestUntil=o,this._aborted=!1,this._timedOut=!1,this._paused=!1,this._created=Date.now(),this._finishHandled=!1,this._retryExponentialTime=new l.ExponentialTime(1e3,3e5),this._options=r(r({},a.DefaultOptions),n)}a.SimpleWebRequestBase=v;o(C,b=v),C.prototype.abort=function(){this._aborted?u.assert(!1,"Already aborted "+this._action+" request to "+this._url):(this._aborted=!0,this._retryTimer&&(a.SimpleWebRequestOptions.clearTimeout(this._retryTimer),this._retryTimer=void 0),this._requestTimeoutTimer&&(a.SimpleWebRequestOptions.clearTimeout(this._requestTimeoutTimer),this._requestTimeoutTimer=void 0),this._deferred?(this._respond("Aborted"),this._xhr&&this._xhr.abort()):u.assert(!1,"Haven't even fired start() yet -- can't abort"))},C.prototype.start=function(){var e=this;return this._deferred?(u.assert(!1,"WebRequest already started"),s.Rejected("WebRequest already started")):(this._deferred=s.Defer(),this._deferred.onCancel(function(){e.abort()}),this._enqueue(),this._deferred.promise())},C.prototype._respond=function(e){var t=this;if(!this._finishHandled){this._finishHandled=!0,this._removeFromQueue(),this._retryTimer&&(a.SimpleWebRequestOptions.clearTimeout(this._retryTimer),this._retryTimer=void 0),this._requestTimeoutTimer&&(a.SimpleWebRequestOptions.clearTimeout(this._requestTimeoutTimer),this._requestTimeoutTimer=void 0);var n,i=0;if(this._xhr)try{i=this._xhr.status,n=this._xhr.statusText||e}catch(e){}else n=e||"Browser Error - Possible CORS or Connectivity Issue";var o,r,s={};if(this._xhr){var e=(this._xhr.getAllResponseHeaders()||"").split(/\r?\n/);if(e.forEach(function(e){var t;0!==e.length&&(-1===(t=e.indexOf(":"))?s[e]="":s[e.substr(0,t).toLowerCase()]=e.substr(t+1).trim())}),s["content-type"]||(e=this._xhr.getResponseHeader("content-type"))&&(s["content-type"]=e),o=this._xhr.response,s["content-type"]&&h(s["content-type"])&&(!o||!u.isObject(o))&&("text"===this._xhr.responseType||""===this._xhr.responseType)&&this._xhr.responseText)try{o=JSON.parse(this._xhr.responseText)}catch(e){r=e,console.warn("Failed to parse XHR JSON response")}}this._xhr&&4===this._xhr.readyState&&(200<=i&&i<300||304===i)?(e={url:this._xhr.responseURL||this._url,method:this._action,requestOptions:this._options,requestHeaders:this._xhrRequestHeaders||{},statusCode:i,statusText:n,headers:s,body:o,responseParsingException:r},this._deferred.resolve(e)):(e={url:(this._xhr?this._xhr.responseURL:void 0)||this._url,method:this._action,requestOptions:this._options,requestHeaders:this._xhrRequestHeaders||{},statusCode:i,statusText:n,headers:s,body:o,canceled:this._aborted,timedOut:this._timedOut,responseParsingException:r},this._options.augmentErrorResponse&&this._options.augmentErrorResponse(e),(i=this._options.customErrorHandler?this._options.customErrorHandler(this,e):f(0,e))!==c.DoNotRetry&&(this._options.retries&&0<this._options.retries||i===c.PauseUntilResumed||i===c.RetryUncountedImmediately||i===c.RetryUncountedWithBackoff)?(i===c.RetryCountedWithBackoff&&this._options.retries--,this._requestTimeoutTimer&&(a.SimpleWebRequestOptions.clearTimeout(this._requestTimeoutTimer),this._requestTimeoutTimer=void 0),this._aborted=!1,this._timedOut=!1,this._finishHandled=!1,this._xhr&&(this._xhr.onabort=null,this._xhr.onerror=null,this._xhr.onload=null,this._xhr.onprogress=null,this._xhr.onreadystatechange=null,this._xhr.ontimeout=null,this._xhr=void 0,this._xhrRequestHeaders=void 0),i===c.PauseUntilResumed?this._paused=!0:i===c.RetryUncountedImmediately?this._enqueue():this._retryTimer=a.SimpleWebRequestOptions.setTimeout(function(){t._retryTimer=void 0,t._enqueue()},this._retryExponentialTime.getTimeAndCalculateNext())):this._deferred.reject(e)),v.checkQueueProcessing()}};var b,k=C;function C(e,t,n,i,o){return b.call(this,e,t,n,i,o)||this}a.SimpleWebRequest=k},function(e,t,n){"use strict";n.r(t),n.d(t,"getServiceEndpoint",function(){return s});var i=n(15),o=n(1),r=n(2),s=function(e){if(Object(o.isGccHigh)()||Object(o.isDoD)()){var t=Object(r.getMetaTagValue)(e);if((n=t)&&-1<n.indexOf("/"))return t}var n;return i.DefaultUrls[e]}},function(e,t,n){"use strict";function i(){this.items={}}n.r(t),i.prototype.clear=function(){this.items={}},i.prototype.getItem=function(e){return this.items[e]},i.prototype.removeItem=function(e){this.items[e]=void 0},i.prototype.setItem=function(e,t){this.items[e]=t},Object.defineProperty(i.prototype,"length",{get:function(){return this.items.length},enumerable:!1,configurable:!0}),t.default=i},function(e,t,n){"use strict";n.r(t),n.d(t,"findMetaTag",function(){return o}),n.d(t,"getMetaTags",function(){return r}),n.d(t,"overrideGetMetaTags",function(){return s});var i,c=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&i>=e.length?void 0:e)&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},o=function(e){return(i=i||r())[e]},r=function(){var t,e,n=Array.from(window.document.getElementsByTagName("meta")),i={};try{for(var o=c(n),r=o.next();!r.done;r=o.next()){var s=r.value;i[s.name]=s.content}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}return i};function s(e){i=e}},function(e,t,n){"use strict";n.r(t),n.d(t,"DefaultUrls",function(){return i});var i={authenticationUrl:"https://login.microsoftonline.com",graphUrl:"https://graph.microsoft.com",shellUrl:"https://webshell.suite.office.com",resourceUrl:"https://outlook.office.com",substrateApiUrl:"https://substrate.office.com",ecsUrl:"https://config.edge.skype.com"}},function(e,t,n){e.exports=n},function(e,t,n){"use strict";n.r(t);var i=n(8);n.d(t,"initialize",function(){return i.initialize})},function(e,t,n){"use strict";
/**
* AllowBackgroundFetchData.ts
* Author: CALIB http://aka.ms/CALIB
* Copyright: Microsoft 2017
*
* Holder for information if background fetch is allowed
*/Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);function o(){this._isAllowed=!1}o.prototype.putBackgroundFetchAllowed=function(e){this._isAllowed=e,this.isBackgroundFetchAllowed()&&this._isAllowedDeferral&&(e=this._isAllowedDeferral,this._isAllowedDeferral=void 0,e.resolve(void 0))},o.prototype.isBackgroundFetchAllowed=function(){return this._isAllowed},o.prototype.waitForBackgroundFetchAllowed=function(){return this.isBackgroundFetchAllowed()?i.Resolved():(this._isAllowedDeferral||(this._isAllowedDeferral=i.Defer()),this._isAllowedDeferral.promise())},t.default=o},function(e,o,r){!function(e){var t=void 0!==e&&e||"undefined"!=typeof self&&self||window,n=Function.prototype.apply;function i(e,t){this._id=e,this._clearFn=t}o.setTimeout=function(){return new i(n.call(setTimeout,t,arguments),clearTimeout)},o.setInterval=function(){return new i(n.call(setInterval,t,arguments),clearInterval)},o.clearTimeout=o.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(t,this._id)},o.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},o.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},o._unrefActive=o.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},r(20),o.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,o.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}.call(this,r(9))},function(e,t,n){!function(e,p){!function(n,r){"use strict";var i,s,c,o,a,u,t,e;function l(e){delete s[e]}function h(e){if(c)setTimeout(h,0,e);else{var t=s[e];if(t){c=!0;try{var n=t,i=n.callback,o=n.args;switch(o.length){case 0:i();break;case 1:i(o[0]);break;case 2:i(o[0],o[1]);break;case 3:i(o[0],o[1],o[2]);break;default:i.apply(r,o)}}finally{l(e),c=!1}}}}function f(){function e(e){e.source===n&&"string"==typeof e.data&&0===e.data.indexOf(t)&&h(+e.data.slice(t.length))}var t="setImmediate$"+Math.random()+"$";n.addEventListener?n.addEventListener("message",e,!1):n.attachEvent("onmessage",e),a=function(e){n.postMessage(t+e,"*")}}n.setImmediate||(i=1,c=!(s={}),o=n.document,e=(e=Object.getPrototypeOf&&Object.getPrototypeOf(n))&&e.setTimeout?e:n,"[object process]"==={}.toString.call(n.process)?a=function(e){p.nextTick(function(){h(e)})}:!function(){var e,t;if(n.postMessage&&!n.importScripts)return e=!0,t=n.onmessage,n.onmessage=function(){e=!1},n.postMessage("","*"),n.onmessage=t,e}()?a=n.MessageChannel?((t=new MessageChannel).port1.onmessage=function(e){h(e.data)},function(e){t.port2.postMessage(e)}):o&&"onreadystatechange"in o.createElement("script")?(u=o.documentElement,function(e){var t=o.createElement("script");t.onreadystatechange=function(){h(e),t.onreadystatechange=null,u.removeChild(t),t=null},u.appendChild(t)}):function(e){setTimeout(h,0,e)}:f(),e.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];return s[i]={callback:e,args:t},a(i),i++},e.clearImmediate=l)}("undefined"==typeof self?void 0===e?this:e:self)}.call(this,n(9),n(21))},function(e,t){var n,i,e=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{i="function"==typeof clearTimeout?clearTimeout:r}catch(e){i=r}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return(n=setTimeout)(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}var c,a=[],u=!1,l=-1;function h(){u&&c&&(u=!1,c.length?a=c.concat(a):l=-1,a.length&&f())}function f(){if(!u){for(var e=s(h),t=(u=!0,a.length);t;){for(c=a,a=[];++l<t;)c&&c[l].run();l=-1,t=a.length}c=null,u=!1,!function(t){if(i===clearTimeout)return clearTimeout(t);if((i===r||!i)&&clearTimeout)return(i=clearTimeout)(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function d(){}e.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];a.push(new p(e,t)),1!==a.length||u||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=d,e.addListener=d,e.once=d,e.off=d,e.removeListener=d,e.removeAllListeners=d,e.emit=d,e.prependListener=d,e.prependOnceListener=d,e.listeners=function(e){return[]},e.binding=function(e){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(e){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},function(e,t,n){"use strict";
/**
* AppActiveData.ts
* Author: CALIB http://aka.ms/CALIB
* Copyright: Microsoft 2017
*
* Holder for App Active (foreground/background) information
*/Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);function o(){this._isActive=!1}o.prototype.putAppActive=function(e){this._isActive=e,this.isAppActive()&&this._appActiveDeferral&&(e=this._appActiveDeferral,this._appActiveDeferral=void 0,e.resolve(void 0))},o.prototype.isAppActive=function(){return this._isActive},o.prototype.waitForAppActive=function(){return this.isAppActive()?i.Resolved():(this._appActiveDeferral||(this._appActiveDeferral=i.Defer()),this._appActiveDeferral.promise())},t.default=o},function(e,t,n){"use strict";
/**
* Cache.ts
* Author: CALIB http://aka.ms/CALIB
* Copyright: Microsoft 2017
*
* ECS data cache
*/Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),c=n(0),o=n(3);function r(e){this._config=e,this.configUpdated=new i.default,this._cachedConfigs={}}r.prototype.initialize=function(){return this.updateConfigsToFetch()},r.prototype.updateConfigsToFetch=function(){var n=this,e=this._config.getConfig(),i=e.databaseInterface,e=e.configsToFetch;if(!i)return c.Resolved();for(var o=[],r=this,t=0,s=e;t<s.length;t++)!function(t){if(r._cachedConfigs[t])return;o.push(i.getData(t).then(function(e){e&&(n._cachedConfigs[t]=e)}).catch(function(){return c.Resolved()}))}(s[t]);return c.all(o).then(function(){0<o.length&&n.configUpdated.fire()})},r.prototype.getEcsConfig=function(){return this._cachedConfigs[o.EcsConfigType.User]||this._cachedConfigs[o.EcsConfigType.Default]},r.prototype.getEcsConfigByType=function(e){return this._cachedConfigs[e]},r.prototype.putConfig=function(e){var t=this.getEcsConfig(),n=(this._cachedConfigs[e.configType]=e,this.getEcsConfig()),t=((n&&n.configType===e.configType||t&&n&&t.configType!==n.configType)&&this.configUpdated.fire(),this._config.getConfig().databaseInterface);return t?t.putData(e.configType,e):c.Resolved()},t.default=r},function(e,t,n){"use strict";
/**
* Config.ts
* Author: CALIB http://aka.ms/CALIB
* Copyright: Microsoft 2017
*
* ECS global configuration
*/var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function o(){}Object.defineProperty(t,"__esModule",{value:!0}),o.prototype.initialize=function(e){if(this._config)throw"ECS Configuration already initialized";this._config=e},o.prototype.getConfig=function(){if(this._config)return this._config;throw"ECS Configuration not yet initialized"},o.prototype.setConfigsToFetch=function(e){if(!this._config)throw"ECS Configuration not yet initialized";this._config=i({},this._config,{configsToFetch:e})},o.prototype.setFetchTimeout=function(e){if(!this._config)throw"ECS Configuration not yet initialized";this._config=i({},this._config,{fetchTimeout:e})},t.default=o},function(e,t,n){"use strict";
/**
* Scheduler.ts
* Author: CALIB http://aka.ms/CALIB
* Copyright: Microsoft 2017
*
* Scheduling module for fetching ECS config
*/Object.defineProperty(t,"__esModule",{value:!0});var c=n(3),a=n(26);function i(e,t,n,i,o,r){var s=this;this._config=e,this._skypeTokenData=t,this._cache=n,this._isFetchingSettings={},this._pendingFetch={},this._paused=!1,this._fetchEcsSettingsIfNeeded=function(e){var t=s._config.getConfig(),n=s._cache.getEcsConfigByType(e);-1===t.configsToFetch.indexOf(e)||s._isFetchingSettings[e]||(!n&&s._pendingFetch[e]||(t=n?n.expiration-Date.now():-1)<=0||n&&e===c.EcsConfigType.User&&s._skypeTokenData.isSkypeTokenValid()&&n.lastFetchTokenHash!==s._skypeTokenData.getSkypeTokenHash(s._skypeTokenData.getSkypeToken())?s._fetchSkypeEcsSettings(e):setTimeout(function(){return s._fetchEcsSettingsIfNeeded(e)},t))},this._fetchSkypeEcsSettings=function(t,e){void 0===e&&(e=!1),s._isFetchingSettings[t]||s._paused&&!e?s._pendingFetch[t]=!0:(s._pendingFetch[t]=!1,s._isFetchingSettings[t]=!0,s._config.getConfig().getEcsParameters().catch(function(){return console.warn("ECS - Failed to fetch ECS fetching parameters"),{}}).then(function(e){return s._ecsClient.getConfig(s._cache.getEcsConfig(),t===c.EcsConfigType.User,e)}).then(function(e){console.log("ECS - Config fetch complete"),s._isFetchingSettings[t]=!1,s._cache.putConfig(e),s._fetchEcsSettingsIfNeeded(t)}))},this._ecsClient=new a.default(this._config,this._skypeTokenData,i,o,r)}i.prototype.initialize=function(){var e=this;this.updateConfigsToFetch(),this._skypeTokenData.skypeTokenChanged.subscribe(function(){return e._fetchEcsSettingsIfNeeded(c.EcsConfigType.User)})},i.prototype.updateConfigsToFetch=function(){for(var e=this._config.getConfig(),t=0,n=e.configsToFetch;t<n.length;t++)(r=n[t])in this._isFetchingSettings||(this._isFetchingSettings[r]=!1),r in this._isFetchingSettings||(this._pendingFetch[r]=!1);for(var i=0,o=e.configsToFetch;i<o.length;i++){var r=o[i],s=this._cache.getEcsConfigByType(r);!s||s.appVersion&&s.appVersion!==e.clientVersion?this._fetchSkypeEcsSettings(r,!0):this._fetchEcsSettingsIfNeeded(r)}},i.prototype.requestUpdate=function(){for(var e=0,t=this._config.getConfig().configsToFetch;e<t.length;e++){var n=t[e];this._fetchSkypeEcsSettings(n)}},i.prototype.pause=function(){this._paused=!0},i.prototype.resume=function(){this._paused=!1;for(var e=0,t=this._config.getConfig().configsToFetch;e<t.length;e++){var n=t[e];this._fetchEcsSettingsIfNeeded(n)}},t.default=i},function(e,t,n){"use strict";
/**
* RestClient.ts
* Author: CALIB http://aka.ms/CALIB
* Copyright: Microsoft 2017
*
* Client helper for accessing ECS.
*/var i,p,d,a,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),_=this&&this.__assign||function(){return(_=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},r=(Object.defineProperty(t,"__esModule",{value:!0}),n(27)),g=n(0),y=n(3),m=n(30),v=(a=r.GenericRestClient,o(s,a),s.prototype._blockRequestUntil=function(e){var t,n=this;return this._getUserConfig&&!this._skypeTokenData.isSkypeTokenValid()&&console.log("ECS - Delaying User config fetch until we have a valid SkypeToken"),this._appActiveData.isAppActive()||this._allowBackgroundFetchData.isBackgroundFetchAllowed()||(t=this._getUserConfig?"User config":"config",console.log("ECS - Delaying "+t+" fetch until the app is active (or background fetch is allowed)")),g.race([this._appActiveData.waitForAppActive(),this._allowBackgroundFetchData.waitForBackgroundFetchAllowed()]).then(function(){if(n._getUserConfig)return n._skypeTokenData.waitForValidSkypeToken()}).then(function(){d=Date.now()})},s.prototype._getHeaders=function(){var e={};return this._etag&&(e["If-None-Match"]=this._etag),this._getUserConfig&&(e.Authorization=this._skypeTokenData.getSkypeToken()),e},s.prototype.getConfig=function(){var e=this._config.getConfig().fetchTimeout;return void 0!==e&&(e<0?e=0:0<e&&e<3e4&&(e=3e4)),a.prototype.performApiGetDetailed.call(this,this._apiPath,{timeout:e})},s);function s(e,t,n,i,o,r,s,c){e=a.call(this,e)||this;return e._config=t,e._skypeTokenData=n,e._appActiveData=i,e._allowBackgroundFetchData=o,e._etag=r,e._getUserConfig=s,e._apiPath="/config/v1/"+e._config.getConfig().clientName+"/"+e._config.getConfig().clientVersion,c&&(t=Object.keys(c).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(c[e].toString())}))&&(e._apiPath+="?"+t.join("&")),e}function c(e,t,n,i,o){this._config=e,this._skypeTokenData=t,this._appActiveData=n,this._allowBackgroundFetchData=i,this._telemetryManager=o,this._ecsFailureBackoffTimer=new r.ExponentialTime(1e3,3e5),this._cacheMaxAgeRegex=/.*max-age=(\d+).*/gi,this._serverIndex=NaN}c.prototype.getConfig=function(c,a,t){var u,l,n,h=this,f=this._config.getConfig().hosts;return(isNaN(this._serverIndex)||this._serverIndex>f.length-1)&&(this._serverIndex=Math.floor(Math.random()*f.length)),f&&f.length?(u=g.Defer(),l=0,(n=function(){var s=c&&c.eTag?c.eTag:void 0,e=new v(f[h._serverIndex],h._config,h._skypeTokenData,h._appActiveData,h._allowBackgroundFetchData,s,a,t);l++,e.getConfig().then(function(e){var t=e.headers.etag,n=e.headers.expires;if(e.body&&e.body.Headers&&(t=t||e.body.Headers.ETag,n=n||e.body.Headers.Expires),p=Date.now(),!t||!n)return console.warn("ECS - Service returned an empty ETag or Expiration header: "+JSON.stringify(e)),g.Rejected();var i,n=new Date(h._calculateExpirationDate(e.headers)).getTime();if(304===e.statusCode&&c)(i=_({},c)).eTag=t,i.expiration=n,i.cacheUpdateTime=p,i.lastFetchTokenHash=h._skypeTokenData.getSkypeTokenHash(e.requestHeaders.Authorization);else{if("object"!=typeof e.body)return console.warn("ECS - Service returned invalid response "+JSON.stringify(e)),g.Rejected();i={config:e.body,configType:a?y.EcsConfigType.User:y.EcsConfigType.Default,eTag:t,expiration:n,cacheUpdateTime:d,lastFetchTokenHash:h._skypeTokenData.getSkypeTokenHash(e.requestHeaders.Authorization),appVersion:h._config.getConfig().clientVersion}}var n=p-d,o=!(n<0||31536e6<n),r=c?Date.now()-c.cacheUpdateTime:0;h._telemetryManager.sendTelemetryEvent(new m.EcsConfigFetchResponse(n,e.statusCode,l,h._skypeTokenData.isSkypeTokenValid(),f[h._serverIndex],t,o,!!s,JSON.stringify(e).length,r,!(c&&0<c.expiration-Date.now()),d,p)),h._ecsFailureBackoffTimer.reset(),u.resolve(i)}).catch(function(){h._serverIndex=(h._serverIndex+1)%f.length,setTimeout(function(){n()},h._ecsFailureBackoffTimer.getTimeAndCalculateNext())})})(),u.promise()):g.Rejected(new Error("no configuration service endpoint"))},c.prototype._calculateExpirationDate=function(e){var t,n,i=Date.now()+1728e5;return e.date&&e.expires?(t=new Date(e.date).getTime(),t=Date.now()-t,n=new Date(e.expires).getTime(),isNaN(n)?i:Math.min(i,n+t)):(n=this._cacheMaxAgeRegex.exec(e["cache-control"]),this._cacheMaxAgeRegex.lastIndex=0,n&&2===n.length?Math.min(i,Date.now()+1e3*Number(n[1])):Date.now()+18e5)},t.default=c},function(e,t,n){
/**
* index.js
* Copyright: Microsoft 2016
*
* Points at typescript source for using with webpack/TSC.
*/
e.exports=n(28)},function(e,n,t){"use strict";function i(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),i(t(10)),i(t(29)),i(t(11))},function(e,t,n){"use strict";
/**
 * GenericRestClient.ts
 * Author: David de Regt
 * Copyright: Microsoft 2015
 *
 * Base client type for accessing RESTful services
 */var s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},c=(Object.defineProperty(t,"__esModule",{value:!0}),n(6)),a=n(11);function i(e){this._defaultOptions={excludeEndpointUrl:!1,withCredentials:!1,retries:0},this._endpointUrl=e}i.prototype._performApiCall=function(e,t,n,i){var o=this,r=(void 0===i&&(i={}),s(s({},this._defaultOptions),i)),i=(n&&(r.sendData=n),r.eTag&&(r.augmentHeaders||(r.augmentHeaders={}),r.augmentHeaders["If-None-Match"]=r.eTag),r.contentType||(r.contentType=c.isString(r.sendData)?"form":"json"),r.excludeEndpointUrl?e:this._endpointUrl+e);return new a.SimpleWebRequest(t,i,r,function(){return o._getHeaders(r)},function(){return o._blockRequestUntil(r)}).start().then(function(e){return o._processSuccessResponse(e),e})},i.prototype._getHeaders=function(e){return{}},i.prototype._blockRequestUntil=function(e){},i.prototype._processSuccessResponse=function(e){},i.prototype.performApiGet=function(e,t){return this.performApiGetDetailed(e,t).then(function(e){return e.body})},i.prototype.performApiGetDetailed=function(e,t){return this._performApiCall(e,"GET",void 0,t)},i.prototype.performApiPost=function(e,t,n){return this.performApiPostDetailed(e,t,n).then(function(e){return e.body})},i.prototype.performApiPostDetailed=function(e,t,n){return this._performApiCall(e,"POST",t,n)},i.prototype.performApiPatch=function(e,t,n){return this.performApiPatchDetailed(e,t,n).then(function(e){return e.body})},i.prototype.performApiPatchDetailed=function(e,t,n){return this._performApiCall(e,"PATCH",t,n)},i.prototype.performApiPut=function(e,t,n){return this.performApiPutDetailed(e,t,n).then(function(e){return e.body})},i.prototype.performApiPutDetailed=function(e,t,n){return this._performApiCall(e,"PUT",t,n)},i.prototype.performApiDelete=function(e,t,n){return this.performApiDeleteDetailed(e,t,n).then(function(e){return e.body})},i.prototype.performApiDeleteDetailed=function(e,t,n){return this._performApiCall(e,"DELETE",t,n)},t.GenericRestClient=i},function(e,t,n){"use strict";
/**
* TelemetryEvents.ts
* Author: CALIB http://aka.ms/CALIB
* Copyright: Microsoft 2017
*
* All the ECS client telemetry events
*/var i,d,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}))(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),n=(Object.defineProperty(t,"__esModule",{value:!0}),n(31)),n=(d=n.TelemetryEventBase,o(r,d),r.prototype.getEventName=function(){return"ecs_tsclient_fetch_config"},r.prototype.getAttributes=function(){var e=d.prototype.getAttributes.call(this);return e.fetch_delay_ms=this._responseTime,e.fetch_response_code=this._responseCode,e.fetch_attempts=this._fetchAttempts,e.authenticated_user=this._hasValidToken,e.url=this._serverEndpoint,e.fetched_etag=this._etag,e.fetch_duration_valid=this._fetchDurationValid,e.cache_available=this._cacheAvailable,e.response_size=this._responseSize,e.config_age=this._configAge,e.config_expired=this._configExpired,e.fetch_start=this._fetchStart,e.fetch_end=this._fetchEnd,e},r);function r(e,t,n,i,o,r,s,c,a,u,l,h,f){var p=d.call(this)||this;return p._responseTime=e,p._responseCode=t,p._fetchAttempts=n,p._hasValidToken=i,p._serverEndpoint=o,p._etag=r,p._fetchDurationValid=s,p._cacheAvailable=c,p._responseSize=a,p._configAge=u,p._configExpired=l,p._fetchStart=h,p._fetchEnd=f,p}t.EcsConfigFetchResponse=n},function(e,t,n){"use strict";
/**
* TelemetryEventBase.ts
* Author: CALIB http://aka.ms/CALIB
* Copyright: Microsoft 2017
*
* Holds ECS client telemetry event base
*/function i(){}Object.defineProperty(t,"__esModule",{value:!0}),i.prototype.getAttributes=function(){return{Source:"ecs_client"}},t.TelemetryEventBase=i},function(e,t,n){"use strict";
/**
* SkypeTokenData.ts
* Author: CALIB http://aka.ms/CALIB
* Copyright: Microsoft 2017
*
* Holder for SkypeToken information
*/Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),o=n(0);function r(){this.skypeTokenChanged=new i.default}r.prototype.putSkypeTokenData=function(e){this._data=e,this.isSkypeTokenValid()&&this.skypeTokenChanged.fire(),this.isSkypeTokenValid()&&this._validSkypeTokenDeferral&&(e=this._validSkypeTokenDeferral,this._validSkypeTokenDeferral=void 0,e.resolve(void 0))},r.prototype.isSkypeTokenValid=function(){var e=this._data;return!!e&&!!e.skypeToken&&e.skypeTokenExpiration>Date.now()},r.prototype.getSkypeToken=function(){var e=this._data;if(e&&e.skypeToken)return e.skypeToken;throw"No Skype Token provided"},r.prototype.getSkypeTokenHash=function(e){return void 0===e?0:e.split("").reduce(function(e,t){return(101*e+t.charCodeAt(0))%999727999},e.length)},r.prototype.waitForValidSkypeToken=function(){return this.isSkypeTokenValid()?o.Resolved():(this._validSkypeTokenDeferral||(this._validSkypeTokenDeferral=o.Defer()),this._validSkypeTokenDeferral.promise())},t.default=r},function(e,t,n){"use strict";
/**
* TelemetryManager.ts
* Author: CALIB http://aka.ms/CALIB
* Copyright: Microsoft 2017
*
* Record new telemtry events and fires update
*/Object.defineProperty(t,"__esModule",{value:!0});var i=n(5);function o(e){this._cache=e,this.telemetryEventAdded=new i.default}o.prototype.sendTelemetryEvent=function(e){var t=e.getEventName(),e=e.getAttributes(),n=!1,i=this._cache.getEcsConfig();i&&o._containsEcsClientTelemetryConfig(i.config)&&((i=i.config.ECSCONFIG)&&i.ecsClientTelemetry&&(n=!!i.ecsClientTelemetry[t])),n&&this.telemetryEventAdded.fire(t,e)},o._containsEcsClientTelemetryConfig=function(e){return!!e&&!!e.ECSCONFIG&&!!e.ECSCONFIG.ecsClientTelemetry},t.default=o}]);